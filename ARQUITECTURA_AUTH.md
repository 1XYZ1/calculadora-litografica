# ๐๏ธ Arquitectura de Autenticaciรณn

## ๐ Diagrama de Componentes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       App.jsx (Root)                       โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ            FirebaseProvider (Context)                 โ  โ
โ  โ  โข db, auth, storage                                  โ  โ
โ  โ  โข user, userId                                       โ  โ
โ  โ  โข loginWithGoogle(), logout()                        โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                       โ                                     โ
โ  โโโโโโโโโโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ              AppContent (Main Logic)                  โ  โ
โ  โ  โข Maneja estado de auth                              โ  โ
โ  โ  โข Muestra AuthModal o App segรบn user                 โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ                       โ                                     โ
โ         โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโ                     โ
โ         โ                            โ                     โ
โ         โผ                            โผ                     โ
โ  โโโโโโโโโโโโโโโ             โโโโโโโโโโโโโโโ              โ
โ  โ  Header.jsx โ             โ AuthModal   โ              โ
โ  โ  โข Logo     โ             โ  โข Google   โ              โ
โ  โ  โข Nav      โ             โ    Login    โ              โ
โ  โ  โข User     โ             โ  โข Errors   โ              โ
โ  โ  โข Logout   โ             โโโโโโโโโโโโโโโ              โ
โ  โโโโโโโโโโโโโโโ                                           โ
โ         โ                                                   โ
โ         โผ                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                             โ
โ  โ     Main Content         โ                             โ
โ  โ  โข Calculator            โ                             โ
โ  โ  โข PriceAdmin            โ                             โ
โ  โ  โข SavedQuotations       โ                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Datos

```
โโโโโโโโโโโโโโโโ
โ   Usuario    โ
โ  Click Login โ
โโโโโโโโฌโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   AuthModal.jsx     โ
โ  onGoogleLogin()    โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโ
โ   AppContent        โ
โ  handleGoogleLogin()โ
โโโโโโโโฌโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  FirebaseContext        โ
โ  loginWithGoogle()      โ
โ  โข GoogleAuthProvider   โ
โ  โข signInWithPopup()    โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Firebase Auth          โ
โ  โข OAuth con Google     โ
โ  โข Retorna user         โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  onAuthStateChanged     โ
โ  โข Actualiza user state โ
โ  โข Actualiza userId     โ
โโโโโโโโฌโโโโโโโโโโโโโโโโโโโ
       โ
       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  App Re-render          โ
โ  โข Muestra Header       โ
โ  โข Muestra Main Content โ
โ  โข Oculta AuthModal     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐๏ธ Estructura de Firestore

```
firestore/
โโโ artifacts/
    โโโ {appId}/
        โโโ public/
        โ   โโโ data/
        โ       โโโ papers/           โ Compartido entre usuarios
        โ       โโโ plateSizes/       โ Todos pueden leer
        โ       โโโ machineTypes/     โ Todos pueden escribir
        โ       โโโ finishingPrices/
        โ       โโโ settings/
        โ           โโโ profit
        โ           โโโ bcvRate
        โ           โโโ ivaRate
        โ
        โโโ users/
            โโโ {userId1}/           โ Solo userId1 puede acceder
            โ   โโโ quotations/
            โ       โโโ {quotationId1}
            โ       โโโ {quotationId2}
            โ
            โโโ {userId2}/           โ Solo userId2 puede acceder
                โโโ quotations/
                    โโโ {quotationId3}
```

---

## ๐ Reglas de Seguridad (Visual)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                Firestore Rules                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ                                                     โ
โ  ๐ artifacts/{appId}/public/data/**               โ
โ     โ READ:  if auth != null                      โ
โ     โ WRITE: if auth != null                      โ
โ     โ Anรณnimos: NO ACCESO                         โ
โ                                                     โ
โ  ๐ artifacts/{appId}/users/{userId}/**            โ
โ     โ READ:  if auth.uid == userId                โ
โ     โ WRITE: if auth.uid == userId                โ
โ     โ Otros usuarios: NO ACCESO                   โ
โ                                                     โ
โ  ๐ Todo lo demรกs                                   โ
โ     โ READ:  DENEGADO                             โ
โ     โ WRITE: DENEGADO                             โ
โ                                                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ Estados de la Aplicaciรณn

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ      Estado: LOADING               โ
โ  โข loadingFirebase = true          โ
โ  โข Muestra: Spinner                โ
โ  โข Auth inicializรกndose            โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโ
                 โ
                 โผ
         โโโโโโโโโโโโโโโโโ
         โ user existe?  โ
         โโโโโฌโโโโโโโโฌโโโโ
             โ       โ
          NO โ       โ Sร
             โ       โ
             โผ       โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  Estado: NO AUTENTICADO  โ  โ  Estado: AUTENTICADO     โ
โ  โข user = null           โ  โ  โข user = {...}          โ
โ  โข Muestra:              โ  โ  โข Muestra:              โ
โ    - Pantalla Bienvenida โ  โ    - Header con usuario  โ
โ    - Botรณn "Comenzar"    โ  โ    - Main Content        โ
โ                          โ  โ    - Navegaciรณn          โ
โ  Acciones:               โ  โ                          โ
โ  โข Click โ AuthModal     โ  โ  Acciones:               โ
โ  โข Login con Google      โ  โ  โข Usar la app          โ
โ                          โ  โ  โข Click Salir โ logout()โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Ciclo de Vida de la Sesiรณn

```
1. App Carga
   โโ FirebaseContext inicializa
      โโ onAuthStateChanged se suscribe

2. Sin Usuario
   โโ user = null
      โโ Muestra pantalla de bienvenida

3. Usuario hace Login
   โโ loginWithGoogle()
      โโ signInWithPopup(GoogleAuthProvider)
         โโ Google OAuth Window
            โโ Usuario selecciona cuenta
               โโ Firebase retorna user
                  โโ onAuthStateChanged dispara
                     โโ user actualizado
                        โโ App re-renderiza

4. Usuario autenticado
   โโ Usa la aplicaciรณn
      โโ Todas las queries usan userId
         โโ Firestore valida con rules

5. Usuario hace Logout
   โโ logout()
      โโ signOut()
         โโ onAuthStateChanged dispara
            โโ user = null
               โโ Vuelve a pantalla bienvenida
```

---

## ๐ฆ Dependencias de Firebase

```javascript
// Instaladas en package.json
{
  "firebase": "^10.x.x",
  "dependencies": {
    "firebase/app",           // โ Inicializaciรณn
    "firebase/auth",          // โ Autenticaciรณn
    "firebase/firestore",     // โ Base de datos
    "firebase/storage"        // โ Archivos (MinIO en tu caso)
  }
}
```

---

## ๐จ Componentes UI (รrbol)

```
App
โโโ FirebaseProvider
    โโโ AppContent
        โโโ Header
        โ   โโโ Logo
        โ   โโโ Navigation Buttons
        โ   โโโ User Section
        โ       โโโ Avatar (foto Google)
        โ       โโโ Display Name
        โ       โโโ Logout Button
        โ
        โโโ Welcome Screen (if !user)
        โ   โโโ Hero Icon
        โ   โโโ Title
        โ   โโโ Description
        โ   โโโ Start Button
        โ   โโโ Features Icons
        โ
        โโโ Main Content (if user)
        โ   โโโ Calculator
        โ   โโโ PriceAdmin
        โ   โโโ SavedQuotations
        โ
        โโโ AuthModal (conditional)
            โโโ Modal Overlay (backdrop blur)
            โโโ Modal Content
            โ   โโโ Close Button
            โ   โโโ Icon
            โ   โโโ Title
            โ   โโโ Description
            โ   โโโ Error Message (if error)
            โ   โโโ Google Login Button
            โ   โ   โโโ Google Logo (SVG)
            โ   โ   โโโ Text
            โ   โโโ Terms Footer
```

---

## ๐ Variables de Entorno

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         .env (Desarrollo)               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ VITE_FIREBASE_API_KEY                   โ
โ VITE_FIREBASE_AUTH_DOMAIN               โ
โ VITE_FIREBASE_PROJECT_ID                โ
โ VITE_FIREBASE_STORAGE_BUCKET            โ
โ VITE_FIREBASE_MESSAGING_SENDER_ID       โ
โ VITE_FIREBASE_APP_ID                    โ
โ VITE_APP_ID                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   src/config/firebase.js                โ
โ   getFirebaseConfig()                   โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   FirebaseContext.jsx                   โ
โ   initializeApp(config)                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Build y Deploy

```
Desarrollo (Local)
โโโ npm run dev
โโโ Vite Dev Server
โโโ http://localhost:5173
    โโโ Variables de .env

Producciรณn
โโโ npm run build
โโโ dist/
โ   โโโ index.html
โ   โโโ assets/
โโโ Deploy a hosting
    โโโ Variables de entorno del hosting
```

---

## ๐ Mรฉtricas de Performance

```
Tamaรฑo de Componentes:
โโโ AuthModal.jsx        ~5 KB
โโโ FirebaseContext.jsx  ~4 KB
โโโ App.jsx             ~8 KB
โโโ Header.jsx          ~4 KB

Tiempo de Carga:
โโโ Inicial: ~1s
โโโ Login: ~2s (incluye OAuth)
โโโ Re-auth: ~500ms (token guardado)

Bundle Size Impact:
โโโ Firebase Auth: ~70 KB (gzipped)
โโโ Tus componentes: ~5 KB
```

---

## โจ Resumen Tรฉcnico

### Stack Completo:

```
Frontend:  React 18 + Vite
Auth:      Firebase Authentication (Google OAuth)
Database:  Cloud Firestore (NoSQL)
Storage:   MinIO (S3-compatible)
Styles:    Tailwind CSS
State:     React Context API
Routing:   Estado local (currentPage)
```

### Patrรณn de Diseรฑo:

- **Context Provider Pattern** para estado global
- **Compound Component Pattern** para modal
- **Render Props** para protecciรณn de rutas
- **Custom Hooks** (useFirebase)

### Seguridad:

- **OAuth 2.0** con Google
- **JWT Tokens** (manejados por Firebase)
- **Security Rules** en Firestore
- **HTTPS Only** (Firebase hosting)

---

ยกTodo listo! ๐
