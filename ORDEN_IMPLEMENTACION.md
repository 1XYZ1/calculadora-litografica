# Roadmap de Implementaci√≥n - Litograf√≠a Pro

## üìã Orden L√≥gico de Implementaci√≥n

Este documento define el orden recomendado para implementar las mejoras propuestas en [PLAN_MEJORA_WORKFLOW.md](./PLAN_MEJORA_WORKFLOW.md), organizadas por dependencias t√©cnicas y valor entregado.

---

## üéØ Iteraci√≥n 1: Fundamentos (Base T√©cnica)

### Objetivo
Establecer la infraestructura base que las dem√°s iteraciones necesitar√°n. Sin esto, habr√° que refactorizar despu√©s.

### Tareas

#### 1.1 Configuraci√≥n de React Router
- **Archivos**:
  - `src/router/index.jsx` - Configuraci√≥n de rutas
  - `src/layouts/MainLayout.jsx` - Layout principal con Outlet
- **Funcionalidad**:
  - Instalar `react-router-dom`
  - Configurar rutas principales: `/calculator`, `/clients`, `/clients/:clientId`, `/price-profiles`, `/quotations`
  - Implementar layout con Header y navegaci√≥n persistente
  - Usar `useNavigate` para navegaci√≥n program√°tica
  - Usar `useLocation` para rutas activas en navegaci√≥n

**Referencias del plan**:
- [FASE 3.1 - React Router y Navegaci√≥n](./PLAN_MEJORA_WORKFLOW.md#31-react-router-y-navegaci√≥n)
- [FASE 3.3 - Navegaci√≥n con React Router](./PLAN_MEJORA_WORKFLOW.md#33-navegaci√≥n-con-react-router)

#### 1.2 Migraci√≥n de Schema en Firestore
- **Colecciones afectadas**: `quotations`, `clients`
- **Nuevos campos en `quotations`**:
  ```javascript
  {
    isTemplate: false,
    templateName: "",
    usageCount: 0,
    duplicatedFrom: null,
    createdVia: "manual" | "template" | "duplicate"
  }
  ```
- **Nuevos campos en `clients`**:
  ```javascript
  {
    quotationCount: 0,
    lastQuotationDate: null,
    totalRevenue: 0
  }
  ```
- **Script de migraci√≥n**: Crear script para actualizar documentos existentes

**Referencias del plan**:
- [Cambios en Arquitectura de Datos](./PLAN_MEJORA_WORKFLOW.md#-cambios-en-arquitectura-de-datos)

#### 1.3 Hooks Compartidos B√°sicos
- **Refactorizar `useClients`**: Mover a contexto global `ClientsContext`
- **Crear `useClientStats`**: Hook para calcular m√©tricas de clientes
- **Estructura**:
  ```
  src/
    context/
      ClientsContext.jsx
    hooks/
      useClientStats.js
    router/
      index.jsx
    layouts/
      MainLayout.jsx
  ```

**Referencias del plan**:
- [Refactorizaciones Necesarias - Hooks Compartidos](./PLAN_MEJORA_WORKFLOW.md#refactorizaciones-necesarias)

### Entregable
- ‚úÖ React Router configurado con todas las rutas
- ‚úÖ Navegaci√≥n con `useNavigate` y `Link` componentes
- ‚úÖ Schemas de Firestore actualizados
- ‚úÖ Datos existentes migrados
- ‚úÖ Hooks compartidos disponibles para otras iteraciones

---

## üöÄ Iteraci√≥n 2: Quick Wins (M√°ximo Impacto)

### Objetivo
Implementar mejoras de alto impacto con esfuerzo bajo. Mejoras tangibles que el usuario notar√° inmediatamente.

### Tareas

#### 2.1 Creaci√≥n de Cliente Inline
- **Ubicaci√≥n**: `src/pages/Calculator/components/QuotationInitialScreen.jsx`
- **Funcionalidad**:
  - Agregar opci√≥n "+ Crear nuevo cliente" en selector
  - Implementar modal `ClientFormModal` reutilizable
  - Auto-seleccionar cliente creado tras guardarlo
- **Componente nuevo**: `src/components/ClientFormModal.jsx`

**Referencias del plan**:
- [FASE 1.2 - Creaci√≥n de Cliente Inline](./PLAN_MEJORA_WORKFLOW.md#12-creaci√≥n-de-cliente-inline)
- [Sprint 1 - Quick Wins](./PLAN_MEJORA_WORKFLOW.md#sprint-1-quick-wins-1-semana)

#### 2.2 Indicador de Perfil de Precios en Calculator
- **Ubicaci√≥n**: Header del stepper en `src/pages/Calculator/Calculator.jsx`
- **Componente nuevo**: `src/pages/Calculator/components/PriceProfileIndicator.jsx`
- **Funcionalidad**:
  - Mostrar perfil activo del cliente
  - Tooltip con detalles (margen, tasa BCV, etc.)
  - Bot√≥n "Cambiar perfil temporalmente" (sin guardar en cliente)

**Referencias del plan**:
- [FASE 1.3 - Indicador de Perfil de Precios](./PLAN_MEJORA_WORKFLOW.md#13-indicador-de-perfil-de-precios-en-calculator)

#### 2.3 Bot√≥n Duplicar Cotizaci√≥n
- **Ubicaci√≥n**: `src/pages/SavedQuotations/components/QuotationCard.jsx`
- **Funcionalidad**:
  - Agregar bot√≥n "Duplicar" en cada cotizaci√≥n
  - Modal simple: ¬øCambiar cliente? ¬øRenombrar?
  - Cargar cotizaci√≥n duplicada en Calculator
- **Tracking**: Registrar `duplicatedFrom` y `createdVia: "duplicate"`

**Referencias del plan**:
- [FASE 2.2 - Duplicaci√≥n Inteligente](./PLAN_MEJORA_WORKFLOW.md#22-duplicaci√≥n-inteligente-de-cotizaciones)

### Entregable
- ‚úÖ Usuarios pueden crear clientes sin salir de Calculator
- ‚úÖ Visibilidad del perfil de precios activo
- ‚úÖ Cotizaciones se pueden duplicar en 2 clics

---

## üìã Iteraci√≥n 3: Sistema de Plantillas

### Objetivo
Implementar el sistema completo de plantillas para reducir trabajo repetitivo. Aprovecha infraestructura de Iteraci√≥n 1 y 2.

### Tareas

#### 3.1 Marcar/Desmarcar Plantillas
- **Ubicaci√≥n**: `src/pages/SavedQuotations/components/QuotationCard.jsx`
- **Funcionalidad**:
  - Checkbox "Marcar como plantilla"
  - Input para nombre descriptivo de plantilla
  - Actualizar Firestore con `isTemplate: true`

#### 3.2 Secci√≥n de Plantillas en SavedQuotations
- **Componente nuevo**: `src/pages/SavedQuotations/components/TemplatesSection.jsx`
- **Funcionalidad**:
  - Filtrar cotizaciones con `isTemplate: true`
  - Ordenar por `usageCount` descendente
  - Bot√≥n "Usar plantilla" ‚Üí carga en Calculator

#### 3.3 Hook de Plantillas
- **Archivo nuevo**: `src/hooks/useQuotationTemplates.js`
- **Funciones**:
  - `useTemplates(userId)` - Filtrar plantillas
  - `incrementUsageCount(templateId)` - Actualizar contador
  - `duplicateFromTemplate(templateId, newClientId)` - Crear desde plantilla

#### 3.4 Contador de Uso
- **Ubicaci√≥n**: `src/utils/calculationEngine.js` o `src/pages/Calculator/hooks/useQuotation.js`
- **Funcionalidad**:
  - Al guardar cotizaci√≥n desde plantilla, incrementar `usageCount`
  - Registrar `duplicatedFrom` con ID de plantilla
  - Registrar `createdVia: "template"`

**Referencias del plan**:
- [FASE 2.1 - Modo "Plantilla"](./PLAN_MEJORA_WORKFLOW.md#21-modo-plantilla-para-cotizaciones)
- [Sprint 3 - Cotizaciones Guardadas](./PLAN_MEJORA_WORKFLOW.md#sprint-3-mejoras-en-cotizaciones-guardadas-1-semana)

### Entregable
- ‚úÖ Cotizaciones se pueden marcar como plantillas
- ‚úÖ Plantillas tienen nombre descriptivo
- ‚úÖ Contador de uso funciona autom√°ticamente
- ‚úÖ Secci√≥n dedicada a plantillas en SavedQuotations

---

## üé® Iteraci√≥n 4: Pantalla de Inicio Mejorada

### Objetivo
Crear punto de entrada unificado para todos los flujos de trabajo. Requiere que plantillas (Iteraci√≥n 3) y quick wins (Iteraci√≥n 2) est√©n listos.

### Tareas

#### 4.1 Nueva Pantalla de Inicio en Calculator
- **Ruta**: `/calculator` (pantalla de inicio)
- **Componente nuevo**: `src/pages/Calculator/components/CalculatorHome.jsx`
- **Reemplaza**: `QuotationInitialScreen.jsx` (o se convierte en segundo paso)
- **Funcionalidad**:
  - 3 botones grandes: "Nueva Cotizaci√≥n", "Cliente Nuevo", "Desde Plantilla"
  - Secci√≥n "Cotizaciones Recientes" (√∫ltimas 5)
  - Usar `useNavigate()` para navegar a `/calculator/new`, `/clients/new`, etc.

#### 4.2 Flujo "Cliente Nuevo" Directo
- **Funcionalidad**:
  - Al hacer click en "Cliente Nuevo":
    1. Mostrar modal de creaci√≥n inline
    2. Guardar cliente
    3. Autom√°ticamente iniciar stepper con ese cliente seleccionado

#### 4.3 Flujo "Desde Plantilla"
- **Componente nuevo**: `src/pages/Calculator/components/TemplateSelector.jsx`
- **Funcionalidad**:
  - Modal con listado de plantillas disponibles
  - Preview r√°pido de √≠tems de la plantilla
  - Al seleccionar ‚Üí cargar en Calculator
  - Usar hook `useTemplates` de Iteraci√≥n 3

#### 4.4 Cotizaciones Recientes
- **Ubicaci√≥n**: Hook `src/pages/Calculator/hooks/useQuotation.js`
- **Funcionalidad**:
  - Funci√≥n `getRecentQuotations(userId, limit=5)`
  - Ordenar por `updatedAt` descendente
  - Mostrar en CalculatorHome con link directo "Abrir"

**Referencias del plan**:
- [FASE 1.1 - Pantalla de Inicio Inteligente](./PLAN_MEJORA_WORKFLOW.md#11-pantalla-de-inicio-inteligente-nueva)
- [Sprint 2 - Pantalla de Inicio](./PLAN_MEJORA_WORKFLOW.md#sprint-2-pantalla-de-inicio-mejorada-1-semana)

### Entregable
- ‚úÖ Punto de entrada √∫nico para todos los flujos
- ‚úÖ Flujo "Cliente Nuevo" completamente integrado
- ‚úÖ Acceso r√°pido a plantillas desde inicio
- ‚úÖ Cotizaciones recientes visibles

---

## üë§ Iteraci√≥n 5: Vista Unificada de Cliente

### Objetivo
Centralizar toda la informaci√≥n y acciones relacionadas con un cliente en una sola p√°gina. Requiere todas las piezas anteriores.

### Tareas

#### 5.1 Nueva P√°gina ClientDetail
- **Ruta**: `/clients/:clientId`
- **Archivo nuevo**: `src/pages/ClientDetail/ClientDetail.jsx`
- **Estructura de tabs**:
  - Tab 1: Informaci√≥n del cliente
  - Tab 2: Cotizaciones del cliente
  - Tab 3: Perfil de precios asignado
  - Tab 4: Historial de actividad

#### 5.2 Tab de Informaci√≥n
- **Componente**: `src/pages/ClientDetail/components/ClientInfoTab.jsx`
- **Funcionalidad**:
  - Formulario editable de datos del cliente
  - Guardar cambios inline
  - Mostrar estad√≠sticas: `quotationCount`, `totalRevenue`, `lastQuotationDate`
  - Usar hook `useClientStats`

#### 5.3 Tab de Cotizaciones
- **Componente**: `src/pages/ClientDetail/components/ClientQuotationsTab.jsx`
- **Funcionalidad**:
  - Listado filtrado de cotizaciones del cliente
  - Reutilizar `QuotationCard` con filtro `clientId`
  - Bot√≥n prominente "+ Nueva Cotizaci√≥n para este cliente"

#### 5.4 Tab de Perfil de Precios
- **Componente**: `src/pages/ClientDetail/components/ClientPriceProfileTab.jsx`
- **Funcionalidad**:
  - Ver perfil asignado al cliente
  - Bot√≥n "Cambiar perfil"
  - Preview de impacto: "Con este perfil, el margen promedio es X%"

#### 5.5 Navegaci√≥n desde Clients
- **Modificar**: `src/pages/Clients/Clients.jsx`
- **Funcionalidad**:
  - Cada card de cliente ‚Üí click ‚Üí `navigate('/clients/' + clientId)`
  - Usar componente `<Link>` de React Router para navegaci√≥n
  - Header autom√°ticamente muestra ruta activa usando `useLocation()`

**Referencias del plan**:
- [FASE 4.1 - Vista de Cliente Unificada](./PLAN_MEJORA_WORKFLOW.md#41-vista-de-cliente-unificada-nueva-p√°gina)
- [Sprint 4 - Vista Unificada](./PLAN_MEJORA_WORKFLOW.md#sprint-4-vista-unificada-de-cliente-2-semanas)

### Entregable
- ‚úÖ P√°gina completa de detalle del cliente
- ‚úÖ Todas las cotizaciones del cliente en un lugar
- ‚úÖ Gesti√≥n de perfil de precios integrada
- ‚úÖ Navegaci√≥n fluida usando React Router con rutas din√°micas

---

## ‚ö° Iteraci√≥n 6: Optimizaciones y Estad√≠sticas

### Objetivo
Refinar la experiencia con insights, accesos r√°pidos y mejoras UX. Puede implementarse despu√©s del MVP.

### Tareas

#### 6.1 Estad√≠sticas en SavedQuotations
- **Componente nuevo**: `src/pages/SavedQuotations/components/QuotationInsights.jsx`
- **Funcionalidad**:
  - Productos m√°s cotizados (top 3)
  - Clientes m√°s activos (top 3)
  - Sugerencias autom√°ticas: "Crea una plantilla para tarjetas est√°ndar"

#### 6.2 Men√∫ de Acciones R√°pidas (FAB)
- **Componente nuevo**: `src/components/FloatingActionButton.jsx`
- **Funcionalidad**:
  - Bot√≥n flotante en esquina inferior derecha
  - Menu desplegable: Nueva Cotizaci√≥n, Nuevo Cliente, Ver Guardadas, Configurar Precios
  - Visible en todas las p√°ginas excepto Calculator (para no interferir)

#### 6.3 Selector de Cliente Mejorado
- **Componente nuevo**: `src/components/ClientSelectorEnhanced.jsx`
- **Funcionalidad**:
  - B√∫squeda en tiempo real (filtrar por nombre, email, tel√©fono)
  - Mostrar stats inline: "12 cotizaciones previas"
  - Ordenar por: M√°s recientes, M√°s cotizaciones, Alfab√©tico
  - Reemplazar selector actual en Calculator

#### 6.4 Previsualizaci√≥n de Impacto de Precios
- **Ubicaci√≥n**: `src/pages/PriceProfiles/PriceProfiles.jsx`
- **Funcionalidad**:
  - Al editar precio, calcular impacto en cotizaciones recientes
  - Mostrar ejemplo: "Tarjetas est√°ndar: +$2.50 (‚Üë5%)"
  - Advertencia si el cambio es >20%

#### 6.5 Plantillas Predefinidas de Perfiles
- **Ubicaci√≥n**: `src/pages/PriceProfiles/PriceProfiles.jsx`
- **Funcionalidad**:
  - Bot√≥n "Importar plantilla"
  - 3 presets disponibles:
    - Est√°ndar (margen 30%)
    - Mayorista (margen 15%)
    - Premium (margen 50%)
  - Aplicar valores predefinidos a todos los precios

**Referencias del plan**:
- [FASE 2.3 - Estad√≠sticas y Sugerencias](./PLAN_MEJORA_WORKFLOW.md#23-estad√≠sticas-y-sugerencias)
- [FASE 3.2 - Men√∫ de Acciones R√°pidas](./PLAN_MEJORA_WORKFLOW.md#32-men√∫-de-acciones-r√°pidas)
- [FASE 4.2 - Selector de Cliente Mejorado](./PLAN_MEJORA_WORKFLOW.md#42-selector-de-cliente-mejorado)
- [FASE 5.1 - Previsualizaci√≥n de Impacto](./PLAN_MEJORA_WORKFLOW.md#51-previsualizaci√≥n-de-impacto-de-precios)
- [FASE 5.2 - Perfiles Sugeridos](./PLAN_MEJORA_WORKFLOW.md#52-perfiles-de-precios-sugeridos)

### Entregable
- ‚úÖ Insights autom√°ticos sobre uso del sistema
- ‚úÖ Accesos r√°pidos desde cualquier p√°gina
- ‚úÖ Selector de cliente con b√∫squeda y stats
- ‚úÖ Preview de impacto al cambiar precios
- ‚úÖ Plantillas predefinidas de perfiles

---

## üìä Resumen Visual del Orden

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Iteraci√≥n 1: FUNDAMENTOS                                ‚îÇ
‚îÇ ‚îî‚îÄ> NavigationContext + Schemas + Hooks compartidos     ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Iteraci√≥n 2: QUICK WINS                                 ‚îÇ
‚îÇ ‚îî‚îÄ> Cliente inline + Perfil indicator + Duplicar        ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Iteraci√≥n 3: PLANTILLAS                                 ‚îÇ
‚îÇ ‚îî‚îÄ> Sistema completo de templates                       ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Iteraci√≥n 4: PANTALLA INICIO                            ‚îÇ
‚îÇ ‚îî‚îÄ> Punto de entrada unificado                          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Iteraci√≥n 5: VISTA CLIENTE                              ‚îÇ
‚îÇ ‚îî‚îÄ> Hub completo de gesti√≥n por cliente                 ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ Iteraci√≥n 6: OPTIMIZACIONES                             ‚îÇ
‚îÇ ‚îî‚îÄ> Stats + FAB + Mejoras UX                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üéØ Criterios de Priorizaci√≥n

Este orden se defini√≥ usando los siguientes criterios:

1. **Dependencias t√©cnicas**: Lo que otros m√≥dulos necesitan va primero
2. **Impacto en UX**: Quick wins tempranos para motivaci√≥n
3. **Complejidad creciente**: De simple a complejo
4. **Reutilizaci√≥n**: Componentes base antes que features avanzadas
5. **MVP vs Nice-to-have**: Core primero, refinamientos despu√©s

---

## ‚úÖ Hitos de Validaci√≥n

Despu√©s de cada iteraci√≥n, validar:

- **Iteraci√≥n 1**: ¬øFunciona React Router correctamente? ¬øLas rutas navegan sin problemas? ¬øLos nuevos campos se guardan en Firestore?
- **Iteraci√≥n 2**: ¬øEl usuario puede crear cotizaciones sin salir de Calculator?
- **Iteraci√≥n 3**: ¬øLas plantillas reducen efectivamente el trabajo repetitivo?
- **Iteraci√≥n 4**: ¬øEl flujo de inicio es intuitivo para usuarios nuevos?
- **Iteraci√≥n 5**: ¬øLa vista de cliente centraliza toda la informaci√≥n relevante? ¬øLas rutas din√°micas funcionan correctamente?
- **Iteraci√≥n 6**: ¬øLas optimizaciones mejoran la eficiencia percibida?

---

## üí° Estrategia de Implementaci√≥n

### MVP M√≠nimo S√≥lido
**Iteraciones 1 + 2 + 3 + 4** (Core Workflow Unificado)

Con esto tienes un workflow funcional y unificado que resuelve los problemas principales identificados en el plan.

### Versi√≥n Completa
**Todas las iteraciones (1-6)**

Para una experiencia pulida con todas las optimizaciones.

### Implementaci√≥n Paralela (Si hay m√∫ltiples desarrolladores)
- **Developer A**: Iteraciones 1, 2, 3
- **Developer B**: Iteraciones 4, 5
- **Developer C**: Iteraci√≥n 6 (en paralelo con 4 y 5)

---

## üìÖ Checkpoints de Progreso

Crear issues/tasks para cada iteraci√≥n con subtareas:

```markdown
## Iteraci√≥n 1: Fundamentos
- [ ] React Router instalado y configurado
- [ ] Rutas principales definidas (/calculator, /clients, /clients/:id, etc.)
- [ ] MainLayout con navegaci√≥n creado
- [ ] Schema migrado en Firestore
- [ ] ClientsContext implementado
- [ ] useClientStats funcionando

## Iteraci√≥n 2: Quick Wins
- [ ] Cliente inline funcional
- [ ] PriceProfileIndicator visible
- [ ] Duplicar cotizaci√≥n funcionando

... (continuar para cada iteraci√≥n)
```

---

**Fecha de creaci√≥n**: Octubre 11, 2025
**Basado en**: [PLAN_MEJORA_WORKFLOW.md](./PLAN_MEJORA_WORKFLOW.md)
**Estado**: üìã Roadmap Aprobado - Listo para Implementaci√≥n
